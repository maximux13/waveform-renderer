---
title: API Reference
description: Complete API documentation for Waveform Renderer
---

Complete reference for all classes, methods, events, and configuration options available in Waveform Renderer.

## WaveformRenderer Class

The main class for creating and managing waveform visualizations.

### Constructor

```typescript
new WaveformRenderer(canvas: HTMLCanvasElement, peaks: number[], options?: Partial<WaveformOptions>)
```

**Parameters:**

- `canvas` - The HTML canvas element where the waveform will be rendered
- `peaks` - Array of peak values (typically from `getPeaksFromAudioBuffer()`)
- `options` - Optional configuration object

**Example:**

```typescript
const canvas = document.getElementById("waveform") as HTMLCanvasElement;
const peaks = getPeaksFromAudioBuffer(audioBuffer, 1000);
const waveform = new WaveformRenderer(canvas, peaks, {
  color: "#3b82f6",
  backgroundColor: "#f1f5f9",
});
```

### Core Methods

#### `destroy(): void`

Destroys the renderer instance and cleans up all resources, event listeners, and cancels pending renders.

```typescript
waveform.destroy();
```

#### `setOptions(options: Partial<WaveformOptions>): void`

Updates the renderer configuration. Only changed options need to be provided.

```typescript
waveform.setOptions({
  color: "#ff6b6b",
  barWidth: 3,
  gap: 2,
});
```

#### `setPeaks(peaks: number[]): void`

Updates the peak data and triggers a re-render. Useful for loading new audio files.

```typescript
const newPeaks = getPeaksFromAudioBuffer(newAudioBuffer, 1000);
waveform.setPeaks(newPeaks);
```

#### `setProgress(progress: number): void`

Updates the playback progress. Value should be between 0 and 1.

```typescript
// Set progress to 50%
waveform.setProgress(0.5);

// Update from audio element
audio.addEventListener("timeupdate", () => {
  waveform.setProgress(audio.currentTime / audio.duration);
});
```

#### `setProgressLineOptions(options: null | Partial<ProgressLineOptions>): void`

Updates or disables the progress line configuration.

```typescript
// Update progress line
waveform.setProgressLineOptions({
  color: "#ff0000",
  width: 3,
  style: "dashed",
});

// Disable progress line
waveform.setProgressLineOptions(null);
```

### Debug Methods

#### `setDebug(enabled: boolean): void`

Enables or disables debug mode with performance logging.

```typescript
waveform.setDebug(true); // Enable debug logs
waveform.setDebug(false); // Disable debug logs
```

#### `getDebugInfo(): DebugInfo`

Returns detailed performance and state information.

```typescript
const debugInfo = waveform.getDebugInfo();
console.log("Render time:", debugInfo.performance.lastRenderTime);
console.log("FPS:", debugInfo.performance.fps);
console.log("Canvas size:", debugInfo.state.canvasSize);
```

#### `resetDebugCounters(): void`

Resets all debug performance counters.

```typescript
waveform.resetDebugCounters();
```

### Advanced Rendering Methods

#### `setCustomRenderer(renderer?: CustomRenderer): void`

Sets a custom renderer function for complete control over rendering.

```typescript
waveform.setCustomRenderer({
  render(ctx, cache, options, staticPath) {
    // Custom rendering logic
    ctx.fillStyle = "linear-gradient(...)";
    // ... custom drawing code
    return true; // Return true if handled completely
  },
});

// Clear custom renderer
waveform.setCustomRenderer();
```

#### `setRenderHooks(hooks: RenderHook): void`

Sets render hooks for extending the default rendering pipeline.

```typescript
waveform.setRenderHooks({
  beforeRender: (ctx, cache, options) => {
    // Called before any rendering starts
  },
  afterBackground: (ctx, cache, options) => {
    // Called after background is drawn
  },
  afterProgress: (ctx, cache, options, progress) => {
    // Called after progress line is drawn
  },
  afterComplete: (ctx, cache, options) => {
    // Called when rendering is complete
  },
});
```

#### `clearRenderHooks(): void`

Removes all render hooks.

```typescript
waveform.clearRenderHooks();
```

## Events

The renderer extends `EventEmitter` and emits the following events:

### Event Types

```typescript
interface WaveformEvents {
  destroy: void;
  error: Error;
  progressChange: number;
  ready: void;
  renderComplete: void;
  renderStart: void;
  resize: { width: number; height: number };
  seek: number;
}
```

### Event Listeners

#### `ready`

Fired when the renderer is fully initialized and ready to use.

```typescript
waveform.on("ready", () => {
  console.log("Waveform is ready!");
});
```

#### `seek`

Fired when user clicks on the waveform to seek. Provides progress value (0-1).

```typescript
waveform.on("seek", progress => {
  audio.currentTime = progress * audio.duration;
});
```

#### `progressChange`

Fired when progress is updated via `setProgress()`.

```typescript
waveform.on("progressChange", progress => {
  console.log(`Progress: ${(progress * 100).toFixed(1)}%`);
});
```

#### `resize`

Fired when canvas is resized (automatic detection).

```typescript
waveform.on("resize", dimensions => {
  console.log(`Canvas resized to ${dimensions.width}x${dimensions.height}`);
});
```

#### `renderStart` / `renderComplete`

Fired when rendering starts and completes.

```typescript
waveform.on("renderStart", () => {
  console.log("Rendering started");
});

waveform.on("renderComplete", () => {
  console.log("Rendering completed");
});
```

#### `error`

Fired when an error occurs.

```typescript
waveform.on("error", error => {
  console.error("Waveform error:", error.message);
});
```

#### `destroy`

Fired when the renderer is destroyed.

```typescript
waveform.on("destroy", () => {
  console.log("Renderer destroyed");
});
```

## Configuration Options

### WaveformOptions

```typescript
interface WaveformOptions {
  amplitude?: number; // Vertical scale multiplier (default: 1)
  backgroundColor?: string; // Canvas background color (default: "#CCCCCC")
  barWidth?: number; // Width of each bar in pixels (default: 2)
  borderColor?: string; // Border color for bars (default: "#000000")
  borderRadius?: number; // Border radius for bars (default: 0)
  borderWidth?: number; // Border width for bars (default: 0)
  color?: string; // Primary waveform color (default: "#000000")
  debug?: boolean; // Enable debug logging (default: false)
  gap?: number; // Gap between bars in pixels (default: 1)
  minPixelRatio?: number; // Minimum pixel ratio for HiDPI (default: 1)
  position?: RenderMode; // Vertical position (default: "center")
  progress?: number; // Initial progress 0-1 (default: 0)
  progressLine?: null | ProgressLineOptions; // Progress line config
  smoothing?: boolean; // Enable canvas smoothing (default: true)
}
```

### ProgressLineOptions

```typescript
interface ProgressLineOptions {
  color?: string; // Line color (default: "#FF0000")
  heightPercent?: number; // Height as percentage of canvas (default: 1)
  position?: RenderMode; // Vertical position (default: "center")
  style?: "solid" | "dashed" | "dotted"; // Line style (default: "solid")
  width?: number; // Line width in pixels (default: 2)
}
```

### RenderMode

```typescript
type RenderMode = "top" | "center" | "bottom";
```

- `"top"` - Align to top of canvas
- `"center"` - Center vertically (default)
- `"bottom"` - Align to bottom of canvas

### Default Values

```typescript
const DEFAULT_OPTIONS = {
  amplitude: 1,
  backgroundColor: "#CCCCCC",
  barWidth: 2,
  borderColor: "#000000",
  borderRadius: 0,
  borderWidth: 0,
  color: "#000000",
  gap: 1,
  minPixelRatio: 1,
  position: "center",
  progress: 0,
  debug: false,
  smoothing: true,
  progressLine: {
    color: "#FF0000",
    heightPercent: 1,
    position: "center",
    style: "solid",
    width: 2,
  },
};
```

## Utility Functions

### `getPeaksFromAudioBuffer(audioBuffer: AudioBuffer, numberOfPeaks: number): number[]`

Extracts peak data from an AudioBuffer for visualization.

**Parameters:**

- `audioBuffer` - Web Audio API AudioBuffer
- `numberOfPeaks` - Number of data points to extract

**Returns:** Array of normalized peak values (-1 to 1)

```typescript
// Load audio file
const response = await fetch("audio.mp3");
const arrayBuffer = await response.arrayBuffer();
const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

// Extract 1000 peaks
const peaks = getPeaksFromAudioBuffer(audioBuffer, 1000);
```

## Advanced Types

### CustomRenderer

Interface for implementing custom rendering logic.

```typescript
interface CustomRenderer {
  render(
    ctx: CanvasRenderingContext2D,
    cache: RenderCache,
    options: Required<WaveformOptions>,
    staticPath?: Path2D,
  ): boolean; // Return true if custom rendering handled everything
}
```

### RenderHook

Interface for extending the rendering pipeline.

```typescript
interface RenderHook {
  beforeRender?: (ctx: CanvasRenderingContext2D, cache: RenderCache, options: Required<WaveformOptions>) => void;
  afterBackground?: (ctx: CanvasRenderingContext2D, cache: RenderCache, options: Required<WaveformOptions>) => void;
  afterProgress?: (
    ctx: CanvasRenderingContext2D,
    cache: RenderCache,
    options: Required<WaveformOptions>,
    progress: number,
  ) => void;
  afterComplete?: (ctx: CanvasRenderingContext2D, cache: RenderCache, options: Required<WaveformOptions>) => void;
}
```

### DebugInfo

Performance and state information returned by `getDebugInfo()`.

```typescript
interface DebugInfo {
  performance: {
    lastRenderTime: number; // Last render time in ms
    averageRenderTime: number; // Average render time in ms
    totalRenders: number; // Total renders performed
    fps: number; // Current FPS
    cacheBuilds: number; // Number of cache rebuilds
    lastCacheBuildTime: number; // Last cache build time in ms
  };
  state: {
    canvasSize: { width: number; height: number };
    peaksCount: number; // Number of peaks
    barsRendered: number; // Number of bars rendered
    cacheValid: boolean; // Cache validity status
    dirtyFlags: DirtyFlags; // What needs re-rendering
  };
  events: {
    totalSeeks: number; // Total seek events
    totalResizes: number; // Total resize events
    totalErrors: number; // Total errors
  };
}
```

## Error Handling

The renderer emits `error` events for various error conditions:

```typescript
waveform.on("error", error => {
  console.error("Waveform error:", error.message);

  // Handle specific error types
  if (error.message.includes("Canvas")) {
    // Canvas-related error
  } else if (error.message.includes("Peaks")) {
    // Peaks data error
  }
});
```

Common error scenarios:

- Invalid canvas element
- Empty or invalid peaks array
- Canvas context creation failure
- Invalid configuration values

## Performance Tips

1. **Use appropriate peak count**: 500-2000 peaks for most use cases
2. **Enable caching**: The built-in cache system handles optimization automatically
3. **Throttle progress updates**: Avoid updating progress more than 60 times per second
4. **Use debug mode**: Monitor performance with `getDebugInfo()`
5. **Clean up**: Always call `destroy()` when removing waveforms

```typescript
// Good: Throttled progress updates
let lastUpdate = 0;
audio.addEventListener("timeupdate", () => {
  const now = Date.now();
  if (now - lastUpdate > 16) {
    // ~60fps
    waveform.setProgress(audio.currentTime / audio.duration);
    lastUpdate = now;
  }
});
```
